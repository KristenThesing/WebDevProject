<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">      
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <style>
    * {
        box-sizing: border-box;
      }
    </style>

    <title>DealBreaker | Browse Profiles</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/general.css" rel="stylesheet">

    <!-- Favicons, generated by Favicon.io -->
    <link rel="apple-touch-icon" sizes="180x180" href="res/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="res/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="res/favicons/favicon-16x16.png">

  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-white fixed-top">
      <div class="container">
        <a class="navbar-brand" href="index.html"><img src="res/logo.png" alt="DealBreaker Logo" id="banner"></a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="logged-in" style="display: none">
                <a class="nav-link" href="browse.html">Browse</a>
            </li>
            <li class="logged-in" style="display: none">
              <a class="nav-link" href="profile.html">My Profile</a>
            </li>
            <li class="logged-in" style="display: none">
                <a class="nav-link" href="editprofile.html">Edit Profile</a>
            </li>
            <li class="logged-in" style="display: none">
                <a class="nav-link" href="subscription.html">Upgrade to Premium</a>
            </li>
            <li class="logged-in" style="display: none">
                <a class="nav-link" id="logout" href="#">Logout</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>   

    <p>Click on a button to choose list view or grid view.</p>

    <div id="btnContainer">
      <button class="btn" onclick="listView()"><i class="fa fa-bars"></i> List</button> 
      <button class="btn active" onclick="gridView()"><i class="fa fa-th-large"></i> Grid</button>
    </div>

    <br>

    <div class="profiles">
      <div class="row">
        <div id="first" class="column" style="background-color:#aaa; display: none;">
          <h2 id="name-0"></h2>
          <img id="profile-picture-0" width="200" height="200">
          <span>
            <p id="DealBreaker-0-1"></p>
            <p id="DealBreaker-0-2"></p>
            <p id="DealBreaker-0-3"></p>
            <p id="age-0"></p>
            <p id="city-0"></p>
            <p>Email: <a id="email-0"></a></p>
          </span>
        </div>

        <div id="second" class="column" style="background-color:#aaa; display: none;">
          <h2 id="name-1"></h2>
          <img id="profile-picture-1" width="200" height="200">
          <span>
            <p id="DealBreaker-1-1"></p>
            <p id="DealBreaker-1-2"></p>
            <p id="DealBreaker-1-3"></p>
            <p id="age-1"></p>
            <p id="city-1"></p>
            <p>Email: <a id="email-1"></a></p>
          </span>
        </div>
      </div>

      <div class="row">
        <div id="third" class="column" style="background-color:#bbb; display: none;">
          <h2 id="name-2"></h2>
          <img id="profile-picture-2" width="200" height="200">
          <span>
            <p id="DealBreaker-2-1"></p>
            <p id="DealBreaker-2-2"></p>
            <p id="DealBreaker-2-3"></p>
            <p id="age-2"></p>
            <p id="city-2"></p>
            <p>Email: <a id="email-2"></a></p>
          </span>     
          </div>
        </div>

        <div id="fourth" class="column" style="background-color:#aaa; display: none;">
          <h2 id="name-3"></h2>
          <img id="profile-picture-3" width="200" height="200">
          <span>
            <p id="DealBreaker-3-1"></p>
            <p id="DealBreaker-3-2"></p>
            <p id="DealBreaker-3-3"></p>
            <p id="age-3"></p>
            <p id="city-3"></p>
            <p>Email: <a id="email-3"></a></p>
          </span>
        </div>
      </div>

      <div class="row">
        <div id="fifth" class="column" style="background-color:#bbb; display: none;">
          <h2 id="name-4"></h2>
          <img id="profile-picture-4" width="200" height="200">
          <span>
            <p id="DealBreaker-4-1"></p>
            <p id="DealBreaker-4-2"></p>
            <p id="DealBreaker-4-3"></p>
            <p id="age-4"></p>
            <p id="city-4"></p>
            <p>Email: <a id="email-4"></a></p>
          </span>     
        </div>

        <div id="sixth" class="column" style="background-color:#aaa; display: none;">
          <h2 id="name-5"></h2>
          <img id="profile-picture-5" width="200" height="200">
          <span>
            <p id="DealBreaker-5-1"></p>
            <p id="DealBreaker-5-2"></p>
            <p id="DealBreaker-5-3"></p>
            <p id="age-5"></p>
            <p id="city-5"></p>
            <p>Email: <a id="email-5"></a></p>
          </span>
        </div>
      </div>
    </div>
  </body>

  <script>
    // Get the elements with class="column"
    var elements = document.getElementsByClassName("column");
    
    // Declare a loop variable
    var i;
    
    // List View
    function listView() {
      for (i = 0; i < elements.length; i++) {
        elements[i].style.width = "80%";
      }
    }
    
    // Grid View
    function gridView() {
      for (i = 0; i < elements.length; i++) {
        elements[i].style.width = "40%";
      }
    }
    
    /* Optional: Add active class to the current button (highlight it) */
    var container = document.getElementById("btnContainer");
    var btns = container.getElementsByClassName("btn");
    for (var i = 0; i < btns.length; i++) {
      btns[i].addEventListener("click", function() {
        var current = document.getElementsByClassName("active");
        current[0].className = current[0].className.replace(" active", "");
        this.className += " active";
      });
    }
  </script>
  <!-- Scripts for Firebase app features -->
  <script src="https://www.gstatic.com/firebasejs/5.9.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.9.3/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.9.3/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.6.0/firebase-functions.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.9.3/firebase-storage.js"></script>

  <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyC-eG4Sn1gAbnYDdSn_kObzVTGTsfH09lk",
        authDomain: "dealbreaker-dating.firebaseapp.com",
        databaseURL: "https://dealbreaker-dating.firebaseio.com",
        storageBucket: "dealbreaker-dating.appspot.com",
        projectId: "dealbreaker-dating",
    };
    
    firebase.initializeApp(config);

    //Make auth and firestore references
    const auth = firebase.auth();
    const db = firebase.firestore();
    const functions = firebase.functions();
    const storage = firebase.storage();
    const storageRef = storage.ref();

    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        var user = firebase.auth().currentUser;

        db.collection('users').where('id', '==', user.uid).get().then((snapshot) => {
          snapshot.docs.forEach(doc => {
            imSeeking = doc.data().seeking;
            myIdentity = doc.data().identity;

            db.collection('users')
              .where('identity', '==', imSeeking).where('seeking', '==', myIdentity)
              .get().then((snapshot) => {

                var userIDs = new Array(6);
                var x = 0;
                var gsReference;
                snapshot.docs.forEach(doc => {
                  if (doc.data().id != user.uid)
                  {
                    userIDs[x] = doc.data().id;

                    if (userIDs[0] != null)
                    {
                      document.getElementById('first').style.display = "block";
                      gsReference = storageRef.child(userIDs[0] + '/profilePicture/profile');
                      gsReference.getDownloadURL().then(function(url) {
                        document.getElementById('profile-picture-0').src=url;
                      });
                    }

                    if (userIDs[1] != null)
                    {
                      document.getElementById('second').style.display = "block";
                      gsReference = storageRef.child(userIDs[1] + '/profilePicture/profile');
                      gsReference.getDownloadURL().then(function(url) {
                        document.getElementById('profile-picture-1').src=url;
                      });
                    }

                    if (userIDs[2] != null)
                    {
                      document.getElementById('third').style.display = "block";
                      gsReference = storageRef.child(userIDs[2] + '/profilePicture/profile');
                      gsReference.getDownloadURL().then(function(url) {
                        document.getElementById('profile-picture-2').src=url;
                      });
                    }

                    if (userIDs[3] != null)
                    {
                      document.getElementById('fourth').style.display = "block";
                      gsReference = storageRef.child(userIDs[3] + '/profilePicture/profile');
                      gsReference.getDownloadURL().then(function(url) {
                        document.getElementById('profile-picture-3').src=url;
                      });
                    }

                    if (userIDs[4] != null)
                    {
                      document.getElementById('fifth').style.display = "block";
                      gsReference = storageRef.child(userIDs[4] + '/profilePicture/profile');
                      gsReference.getDownloadURL().then(function(url) {
                        document.getElementById('profile-picture-4').src=url;
                      });
                    }

                    if (userIDs[5] != null)
                    {
                      document.getElementById('sixth').style.display = "block";
                      gsReference = storageRef.child(userIDs[5] + '/profilePicture/profile');
                      gsReference.getDownloadURL().then(function(url) {
                        document.getElementById('profile-picture-5').src=url;
                      });
                    }

                    x++;
                  }
                });
            });
          });
        });
      }
    });
  </script>

  <!-- Bootstrap core JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="js/browse.js"></script>
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
</html>
